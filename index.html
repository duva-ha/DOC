<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyBTdEZpcTQ1ohSGGNcJg-gkEfVPgdZ9FVg",
        authDomain: "mega-2a7b2c.firebaseapp.com",
        projectId: "mega-2a7b2c",
        storageBucket: "mega-2a7b2c.firebasestorage.app",
        messagingSenderId: "344986191358",
        appId: "1:344986191358:web:91946739efe40b97df2caf"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Hàm chuyển file thành chuỗi Base64 để lưu vào Firestore
    window.uploadDirectToFirestore = async (event) => {
        const file = event.target.files[0];
        if (!file) return;
        
        // Giới hạn file dưới 1MB để đảm bảo Firestore hoạt động tốt
        if (file.size > 1024 * 1024) {
            alert("File quá lớn! Vui lòng chọn file dưới 1MB hoặc dùng link Drive.");
            return;
        }

        const reader = new FileReader();
        reader.readAsDataURL(file); // Chuyển file sang Base64
        reader.onload = async () => {
            const base64String = reader.result;
            try {
                await addDoc(collection(db, "smart_docs"), {
                    name: file.name,
                    content: base64String, // Nội dung file đã mã hóa
                    type: file.name.split('.').pop().toLowerCase(),
                    createdAt: new Date().getTime()
                });
                alert("Đã lưu file thành công vào Firestore!");
                loadData();
            } catch (e) {
                alert("Lỗi khi lưu dữ liệu!");
            }
        };
    };
</script>
